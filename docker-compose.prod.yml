name: knowledge-base

services:
    app:
        image: stonek79/knowledge-base:${APP_VERSION:-latest}
        container_name: kb-app
        env_file: .env.prod
        restart: unless-stopped
        depends_on:
            postgres:
                condition: service_healthy
            redis:
                condition: service_healthy
            minio:
                condition: service_healthy
            gotenberg:
                condition: service_healthy
        networks:
            - kb-network

    worker:
        image: stonek79/knowledge-base:${APP_VERSION:-latest}
        container_name: kb-worker
        env_file: .env.prod
        restart: unless-stopped
        command: pnpm start:prod:worker
        depends_on:
            postgres:
                condition: service_healthy
            redis:
                condition: service_healthy
        networks:
            - kb-network
